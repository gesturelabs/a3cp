{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://gesturelabs.org/schemas/gesture_classifier.schema.json",
    "title": "Gesture Classifier Schema",
    "description": "Schema for gesture_classifier input and output messages.",
    "type": "object",
    "$defs": {
        "FileReference": {
            "type": "object",
            "title": "FileReference",
            "properties": {
                "uri": {
                    "type": "string",
                    "description": "Path or URI to model or encoder file (e.g., .h5, .pkl)"
                },
                "hash": {
                    "type": "string",
                    "description": "SHA-256 hash of the referenced file"
                },
                "version": {
                    "type": "string",
                    "description": "Semantic or internal version string"
                },
                "type": {
                    "type": "string",
                    "enum": [
                        "model",
                        "encoder"
                    ],
                    "description": "Type of reference (model or encoder)"
                }
            },
            "required": [
                "uri",
                "hash",
                "version",
                "type"
            ]
        },
        "RawFeaturesRef": {
            "type": "object",
            "title": "RawFeaturesRef",
            "properties": {
                "uri": {
                    "type": "string",
                    "description": "Path to stored landmark time series (e.g., .parquet or .npy)"
                },
                "hash": {
                    "type": "string",
                    "description": "SHA-256 content hash for file integrity"
                },
                "encoding": {
                    "type": "string",
                    "description": "Landmark encoding spec used (e.g., mediapipe_pose_v1.2)"
                },
                "dims": {
                    "type": "integer",
                    "description": "Total dimensionality of the landmark vector"
                },
                "format": {
                    "type": "string",
                    "enum": [
                        "parquet",
                        "npy"
                    ],
                    "description": "Storage format of landmark series"
                }
            },
            "required": [
                "uri",
                "hash",
                "encoding",
                "dims",
                "format"
            ]
        },
        "GestureClassifierInput": {
            "type": "object",
            "title": "GestureClassifierInput",
            "properties": {
                "schema_version": {
                    "type": "string",
                    "const": "1.0.0",
                    "default": "1.0.0"
                },
                "record_id": {
                    "type": "string",
                    "description": "UUID for this message"
                },
                "user_id": {
                    "type": "string",
                    "description": "Pseudonymous user ID"
                },
                "session_id": {
                    "type": "string",
                    "description": "Session identifier"
                },
                "timestamp": {
                    "type": "string",
                    "description": "UTC ISO8601 timestamp"
                },
                "raw_features_ref": {
                    "$ref": "#/$defs/RawFeaturesRef",
                    "description": "Reference to stored gesture landmarks"
                },
                "vector_version": {
                    "anyOf": [
                        {
                            "type": "string"
                        },
                        {
                            "type": "null"
                        }
                    ],
                    "default": null,
                    "description": "Version of preprocessing pipeline used"
                },
                "model_ref": {
                    "$ref": "#/$defs/FileReference",
                    "description": "Reference to model.h5 artifact to use"
                },
                "encoder_ref": {
                    "$ref": "#/$defs/FileReference",
                    "description": "Reference to encoder.pkl artifact to use"
                }
            },
            "required": [
                "record_id",
                "user_id",
                "session_id",
                "timestamp",
                "raw_features_ref",
                "model_ref",
                "encoder_ref"
            ]
        },
        "GestureClassifierOutput": {
            "type": "object",
            "title": "GestureClassifierOutput",
            "properties": {
                "schema_version": {
                    "type": "string",
                    "const": "1.0.0",
                    "default": "1.0.0"
                },
                "record_id": {
                    "type": "string",
                    "description": "Copied from input"
                },
                "user_id": {
                    "type": "string",
                    "description": "Copied from input"
                },
                "session_id": {
                    "type": "string",
                    "description": "Copied from input"
                },
                "timestamp": {
                    "type": "string",
                    "description": "UTC ISO8601 timestamp of prediction"
                },
                "classifier_output": {
                    "type": "object",
                    "description": "Map of predicted intent labels to confidence scores (0.0â€“1.0)",
                    "additionalProperties": {
                        "type": "number",
                        "minimum": 0.0,
                        "maximum": 1.0
                    }
                },
                "model_ref": {
                    "$ref": "#/$defs/FileReference",
                    "description": "Reference to model.h5 artifact used"
                },
                "encoder_ref": {
                    "$ref": "#/$defs/FileReference",
                    "description": "Reference to encoder.pkl artifact used"
                }
            },
            "required": [
                "record_id",
                "user_id",
                "session_id",
                "timestamp",
                "classifier_output",
                "model_ref",
                "encoder_ref"
            ]
        }
    }
}
