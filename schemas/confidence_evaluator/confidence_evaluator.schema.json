{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://gesturelabs.org/schemas/confidence_evaluator/confidence_evaluator.schema.json",
    "title": "ConfidenceEvaluator Schema",
    "description": "Schemas for input and output of the ConfidenceEvaluator module.",
    "type": "object",
    "oneOf": [
        {
            "$ref": "#/$defs/ConfidenceEvaluatorInput"
        },
        {
            "$ref": "#/$defs/ConfidenceEvaluatorOutput"
        }
    ],
    "$defs": {
        "RankedIntent": {
            "type": "object",
            "properties": {
                "intent": {
                    "type": "string",
                    "description": "Predicted intent label"
                },
                "base_confidence": {
                    "type": "number",
                    "minimum": 0.0,
                    "maximum": 1.0,
                    "description": "Raw classifier confidence"
                },
                "memory_boost": {
                    "type": "number",
                    "default": 0.0,
                    "description": "Score adjustment from memory"
                },
                "context_alignment": {
                    "type": "number",
                    "default": 0.0,
                    "description": "Score adjustment from context relevance"
                },
                "final_score": {
                    "type": [
                        "number",
                        "null"
                    ],
                    "description": "Total score after integration (if computed)"
                }
            },
            "required": [
                "intent",
                "base_confidence"
            ],
            "additionalProperties": false
        },
        "ConfidenceEvaluatorInput": {
            "type": "object",
            "description": "Input for scoring confidence and ranking intents.",
            "properties": {
                "classifier_output": {
                    "type": "array",
                    "items": {
                        "$ref": "#/$defs/RankedIntent"
                    },
                    "description": "Intent candidates with base and optional components"
                },
                "memory_intent_boosts": {
                    "type": "object",
                    "description": "Per-intent user memory weights",
                    "additionalProperties": {
                        "type": "number"
                    },
                    "default": {}
                },
                "context_topic_tag": {
                    "type": [
                        "string",
                        "null"
                    ],
                    "description": "Tag describing the inferred topic or domain"
                },
                "context_relevance_score": {
                    "type": [
                        "number",
                        "null"
                    ],
                    "minimum": 0.0,
                    "maximum": 1.0,
                    "description": "Score indicating topic relevance"
                },
                "timestamp": {
                    "type": "string",
                    "format": "date-time",
                    "description": "Timestamp of evaluation"
                },
                "session_id": {
                    "type": "string",
                    "description": "Session identifier"
                },
                "user_id": {
                    "type": "string",
                    "description": "User identifier"
                }
            },
            "required": [
                "classifier_output",
                "timestamp",
                "session_id",
                "user_id"
            ],
            "additionalProperties": false
        },
        "ConfidenceEvaluatorOutput": {
            "type": "object",
            "description": "Output after re-ranking and scoring intent candidates.",
            "properties": {
                "classifier_output": {
                    "type": "array",
                    "items": {
                        "$ref": "#/$defs/RankedIntent"
                    },
                    "description": "Ranked and scored intent candidates"
                },
                "context_flags": {
                    "type": "object",
                    "description": "Flags passed downstream for clarification or audit",
                    "additionalProperties": {
                        "type": "boolean"
                    },
                    "default": {}
                },
                "final_decision": {
                    "type": [
                        "string",
                        "null"
                    ],
                    "description": "Chosen intent label if confidence threshold met"
                },
                "timestamp": {
                    "type": "string",
                    "format": "date-time",
                    "description": "Timestamp of output"
                },
                "audit_log": {
                    "type": "object",
                    "description": "Explanation of final scores and components",
                    "additionalProperties": {
                        "type": "string"
                    }
                }
            },
            "required": [
                "classifier_output",
                "timestamp",
                "audit_log"
            ],
            "additionalProperties": false
        }
    }
}
