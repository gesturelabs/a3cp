{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://gesturelabs.org/schemas/clarification_planner/clarification_planner.schema.json",
    "title": "ClarificationPlanner Schema",
    "description": "Schemas for input and output of the ClarificationPlanner module.",
    "type": "object",
    "oneOf": [
        {
            "$ref": "#/$defs/ClarificationPlannerInput"
        },
        {
            "$ref": "#/$defs/ClarificationPlannerOutput"
        }
    ],
    "$defs": {
        "RankedIntent": {
            "type": "object",
            "properties": {
                "intent": {
                    "type": "string",
                    "description": "Predicted intent label"
                },
                "confidence": {
                    "type": "number",
                    "minimum": 0.0,
                    "maximum": 1.0,
                    "description": "Confidence score"
                }
            },
            "required": [
                "intent",
                "confidence"
            ],
            "additionalProperties": false
        },
        "ClarificationPlannerInput": {
            "type": "object",
            "description": "Input schema for ClarificationPlanner module.",
            "properties": {
                "classifier_output": {
                    "type": "array",
                    "items": {
                        "$ref": "#/$defs/RankedIntent"
                    },
                    "description": "Ranked intents with confidence scores"
                },
                "context_flags": {
                    "type": "object",
                    "description": "Contextual flags (e.g., question_detected)",
                    "additionalProperties": {
                        "type": "boolean"
                    },
                    "default": {}
                },
                "context_topic_tag": {
                    "type": [
                        "string",
                        "null"
                    ],
                    "description": "Inferred topic tag"
                },
                "context_relevance_score": {
                    "type": [
                        "number",
                        "null"
                    ],
                    "minimum": 0.0,
                    "maximum": 1.0,
                    "description": "Context relevance to known intents"
                },
                "timestamp": {
                    "type": "string",
                    "format": "date-time",
                    "description": "UTC ISO 8601 timestamp"
                },
                "session_id": {
                    "type": "string",
                    "description": "Unique session identifier"
                },
                "user_id": {
                    "type": "string",
                    "description": "User identifier"
                },
                "unresolved_intents": {
                    "type": [
                        "array",
                        "null"
                    ],
                    "description": "Recent unresolved or corrected intents",
                    "items": {
                        "type": "string"
                    }
                }
            },
            "required": [
                "classifier_output",
                "timestamp",
                "session_id",
                "user_id"
            ],
            "additionalProperties": false
        },
        "ClarificationPlannerOutput": {
            "type": "object",
            "description": "Output schema for ClarificationPlanner module.",
            "properties": {
                "clarification_trigger": {
                    "type": "boolean",
                    "description": "Whether clarification should be requested"
                },
                "clarification_payload": {
                    "type": [
                        "object",
                        "null"
                    ],
                    "description": "Payload passed to LLM Clarifier"
                },
                "audit_log": {
                    "type": "object",
                    "description": "Explanation and threshold criteria for decision",
                    "additionalProperties": {
                        "type": "string"
                    }
                },
                "final_decision_override": {
                    "type": [
                        "string",
                        "null"
                    ],
                    "description": "Optional final decision suggestion if clarification is skipped"
                }
            },
            "required": [
                "clarification_trigger",
                "audit_log"
            ],
            "additionalProperties": false
        }
    }
}
