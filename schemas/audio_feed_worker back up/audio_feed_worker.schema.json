{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://gesturelabs.org/schemas/audio_feed_worker/audio_feed_worker.schema.json",
    "title": "AudioFeedWorker Schema",
    "description": "Contains configuration and runtime output schemas for the AudioFeedWorker module.",
    "type": "object",
    "oneOf": [
        {
            "$ref": "#/$defs/AudioFeedWorkerConfig"
        },
        {
            "$ref": "#/$defs/AudioChunkMetadata"
        }
    ],
    "$defs": {
        "AudioFeedWorkerConfig": {
            "type": "object",
            "description": "Configuration for audio device and buffer parameters.",
            "properties": {
                "device_index": {
                    "type": [
                        "integer",
                        "null"
                    ],
                    "description": "Index of the audio input device"
                },
                "sample_rate": {
                    "type": "integer",
                    "description": "Target sample rate in Hz, e.g., 16000"
                },
                "chunk_size": {
                    "type": "integer",
                    "description": "Internal buffer size in samples (not logged)"
                }
            },
            "required": [
                "sample_rate",
                "chunk_size"
            ],
            "additionalProperties": false
        },
        "AudioChunkMetadata": {
            "type": "object",
            "description": "Metadata for a captured audio chunk.",
            "properties": {
                "timestamp": {
                    "type": "string",
                    "format": "date-time",
                    "description": "UTC timestamp in ISO 8601 format"
                },
                "device_id": {
                    "type": [
                        "string",
                        "null"
                    ],
                    "description": "Optional device identifier"
                },
                "sample_rate": {
                    "type": "integer",
                    "description": "Sample rate used for capture"
                },
                "waveform_format": {
                    "type": "string",
                    "enum": [
                        "bytes",
                        "base64",
                        "ndarray"
                    ],
                    "description": "Encoding format for audio_payload"
                },
                "audio_payload": {
                    "type": "string",
                    "description": "Encoded waveform data"
                },
                "modality": {
                    "type": "string",
                    "const": "audio",
                    "description": "Always 'audio'"
                },
                "source": {
                    "type": "string",
                    "const": "communicator",
                    "description": "Always 'communicator'"
                },
                "error": {
                    "type": [
                        "string",
                        "null"
                    ],
                    "description": "Optional error message"
                }
            },
            "required": [
                "timestamp",
                "sample_rate",
                "waveform_format",
                "audio_payload",
                "modality",
                "source"
            ],
            "additionalProperties": false
        }
    }
}
