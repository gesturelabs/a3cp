# Gesture Slice — Architectural Contract (Revised for WebSocket Streaming)

This document defines architectural constraints for the Gesture Slice.
It is normative for this slice and must be respected by all participating modules.

These rules are slice-scoped and apply only within the Gesture Slice.

---

## Ground Rules

- Schemas are treated as **frozen** during this slice.
  - Changes are permitted only to resolve a hard blocker.

- All recorded events are **append-only**.
  - In-place edits or mutations are forbidden.

---

## Identifier Discipline

### 1) Recorded / Pipeline Events (A3CPMessage-level)

The following identifiers are REQUIRED for all recorded schema events
and all A3CPMessages exchanged between modules:

- `user_id`
- `session_id`
- `timestamp`
- `record_id`

Rules:

- `record_id` is generated by the **emitting module** for each recorded event.
- `session_id` is generated by `session_manager`.
- Modules MUST NOT fabricate identifiers owned by other modules.
- Recorded events MUST be suitable for append-only logging.

---

### 2) Streaming Frame Transport (camera_feed_worker Exception)

`camera_feed_worker` is a **streaming transport boundary**, not a recorded event emitter.

For raw frame streaming (browser → camera_feed_worker → landmark_extractor):

- Correlation is based on:
  - `capture_id`
  - `seq`
- `user_id` and `session_id` MUST be present at capture open.
- `timestamp_frame` (event-time) MUST be preserved.
- Per-frame `record_id` is NOT required.
- `camera_feed_worker` MUST NOT generate per-frame `record_id`.

This streaming boundary is explicitly exempt from the per-event `record_id`
requirement because:

- Raw frames are transient.
- Raw frames are not persisted.
- Feature-level artifacts are the first recorded outputs.

---

## Storage Policy (Sprint 1 — Locked)

- Do NOT persist raw video frames or streams to disk.
- Persist ONLY landmark-derived feature artifacts and their
  `raw_features_ref` metadata in session JSONL:
  - `uri`
  - `sha256`
  - `encoding`
  - `dims`
  - `format`

Log-writing authority:

- Only `recorded_schemas` may append to:

## Status

This contract reflects the WebSocket-based streaming architecture
and the camera_feed_worker streaming exception.

It may be retired or replaced when the Gesture Slice is complete.
